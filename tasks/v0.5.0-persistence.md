# Version 0.5.0 - Persistence

**Theme:** JSON storage, environment config.

**Plan:** [playtime-release-plan.md](../playtime-release-plan.md)

---

## Goals

- Implement JSON file-based storage
- Externalize secrets to environment variables

---

## Stories

### Epic: Environment Configuration

| ID    | Story                                                                          | Points | Acceptance Criteria                                           |
| ----- | ------------------------------------------------------------------------------ | ------ | ------------------------------------------------------------- |
| S-047 | As a developer, I want dotenv configured so that secrets are externalized      | 2      | dotenv package installed; process.env values loaded from .env |
| S-048 | As a developer, I want cookie settings in .env so that secrets are not in code  | 2      | cookie_name and cookie_password read from environment        |
| S-049 | As a developer, I want a .env_example file so that setup is documented          | 1      | Template file with placeholder values committed              |
| S-050 | As a developer, I want .env in .gitignore so that secrets are not committed    | 1      | .env excluded from git                                        |

### Epic: JSON File Storage

| ID    | Story                                                                            | Points | Acceptance Criteria                                                      |
| ----- | -------------------------------------------------------------------------------- | ------ | ------------------------------------------------------------------------ |
| S-051 | As a developer, I want LowDB configured so that data persists to JSON             | 3      | lowdb package installed; store-utils.js configures JSONFilePreset        |
| S-052 | As a developer, I want a user JSON store so that users persist across restarts   | 3      | user-json-store.js implements UserStore interface with db.read()/write()  |
| S-053 | As a developer, I want a playlist JSON store so that playlists persist           | 3      | playlist-json-store.js implements PlaylistStore interface                 |
| S-054 | As a developer, I want a track JSON store so that tracks persist                 | 3      | track-json-store.js implements TrackStore interface                       |
| S-055 | As a developer, I want db.js to use JSON stores by default so that data persists | 1      | db.init() assigns JSON stores to userStore, playlistStore, trackStore     |

### Epic: E2E Persistence and Validation (Testing)

| ID   | Story                                                                                          | Points | Acceptance Criteria                                                                 |
| ---- | ---------------------------------------------------------------------------------------------- | ------ | ----------------------------------------------------------------------------------- |
| T-012 | As a developer, I want E2E persistence tests so that data survives server restart              | 2      | test/e2e/persistence.spec.js: create user/playlist/track, restart server, login and confirm data present |
| T-013 | As a developer, I want E2E validation tests for signup/login so that error messages are shown   | 2      | test/e2e/persistence.spec.js (or auth): invalid signup and invalid login show validation errors |

---

## New Deliverables

```
+ .env_example
+ src/models/json/
    + db.json
    + store-utils.js
    + user-json-store.js
    + playlist-json-store.js
    + track-json-store.js

Modified:
~ .gitignore (.env added)
~ package.json (dotenv, lowdb)
~ src/server.js (dotenv, env-based cookie config)
~ src/models/db.js (JSON store imports)
+ test/e2e/persistence.spec.js
```

---

## Total: ~21 Story Points
