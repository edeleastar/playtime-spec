# Version 0.6.0 - Quality

**Theme:** Joi validation, complete validation, store robustness.

**Plan:** [playtime-release-plan.md](../playtime-release-plan.md)

---

## Goals

- Configure Joi and add signup validation (UserSpec, error partial)
- Add validation to all remaining forms (login, playlist, track)
- Improve store robustness (null returns, safe delete)

---

## Stories

### Epic: Joi and Signup Validation

| ID    | Story                                                                                  | Points | Acceptance Criteria                                                     |
| ----- | -------------------------------------------------------------------------------------- | ------ | ----------------------------------------------------------------------- |
| S-056 | As a developer, I want Joi configured as server validator so that schemas work         | 2      | Joi package installed; server.validator(Joi) called                     |
| S-057 | As a developer, I want a UserSpec schema so that signup input is validated              | 2      | joi-schemas.js exports UserSpec with required fields                    |
| S-058 | As a visitor, I want validation errors on signup so that I can fix mistakes             | 3      | failAction re-renders form with errors; error partial displays messages |
| S-059 | As a developer, I want an error partial so that validation errors display consistently  | 2      | error.hbs iterates errors array and shows messages                      |

### Epic: Store Robustness

| ID    | Story                                                                                                         | Points | Acceptance Criteria                              |
| ----- | ------------------------------------------------------------------------------------------------------------- | ------ | ------------------------------------------------ |
| S-070 | As a developer, I want getUserById to return null (not undefined) when not found                               | 2      | JSON store checks for undefined and returns null |
| S-071 | As a developer, I want getUserByEmail to return null (not undefined) when not found                            | 1      | JSON store checks for undefined and returns null |
| S-072 | As a developer, I want deleteUserById to check index before splice so that invalid deletes don't corrupt data | 2      | Check index !== -1 before splice                 |

### Epic: Complete Validation

| ID    | Story                                                                                | Points | Acceptance Criteria                                    |
| ----- | ------------------------------------------------------------------------------------ | ------ | ------------------------------------------------------ |
| S-073 | As a developer, I want a UserCredentialsSpec schema so that login is validated       | 2      | Schema with required email (valid format) and password |
| S-074 | As a visitor, I want validation errors on login so that I can fix mistakes            | 2      | failAction on login route shows errors                 |
| S-075 | As a developer, I want a PlaylistSpec schema so that playlist creation is validated  | 1      | Schema with required title                             |
| S-076 | As a user, I want validation errors when adding playlists so that I can fix mistakes | 2      | failAction on addPlaylist route shows errors           |
| S-077 | As a developer, I want a TrackSpec schema so that track creation is validated        | 2      | Schema with required title/artist, optional duration   |
| S-078 | As a user, I want validation errors when adding tracks so that I can fix mistakes    | 2      | failAction on addTrack route shows errors              |

### Epic: E2E Validation Forms (Testing)

| ID   | Story                                                                                          | Points | Acceptance Criteria                                                                 |
| ---- | ---------------------------------------------------------------------------------------------- | ------ | ----------------------------------------------------------------------------------- |
| T-014 | As a developer, I want E2E validation tests for playlist and track forms so that errors are shown | 2      | test/e2e/quality.spec.js: invalid playlist title and invalid track input show validation errors |

---

## New Deliverables

```
+ src/models/joi-schemas.js
+ src/views/partials/error.hbs
+ test/e2e/quality.spec.js

Modified:
~ package.json (joi)
~ src/server.js (Joi validator)
~ src/web-routes.js (signup validation: UserSpec, failAction)
~ src/views/signup-view.hbs (error partial, payload re-population)
~ src/models/joi-schemas.js (UserCredentialsSpec, PlaylistSpec, TrackSpec)
~ src/models/json/user-json-store.js (null returns, safe delete)
~ src/controllers/accounts-controller.js (login validation)
~ src/controllers/dashboard-controller.js (playlist validation)
~ src/controllers/playlist-controller.js (track validation)
```

---

## Total: ~27 Story Points
