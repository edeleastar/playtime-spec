# Version 0.7.0 - MongoDB

**Theme:** Mongoose/MongoDB implementation of the model layer.

**Plan:** [playtime-release-plan.md](../playtime-release-plan.md)

---

## Goals

- Introduce Mongoose and MongoDB as a persistence option
- Implement User, Playlist, and Track Mongoose models and stores
- Use Mongo stores when configured (e.g. via MONGO_URI)
- Add unit tests for Mongo store implementations
- Add E2E tests that run against MongoDB

---

## Stories

### Epic: MongoDB Configuration

| ID    | Story                                                                                    | Points | Acceptance Criteria                                                       |
| ----- | ---------------------------------------------------------------------------------------- | ------ | ------------------------------------------------------------------------- |
| S-079 | As a developer, I want Mongoose and MongoDB configured so that I can persist to Mongo   | 3      | mongoose package installed; connection from process.env.MONGO_URI; connect on init |
| S-080 | As a developer, I want MONGO_URI in .env so that the database is configurable           | 1      | .env_example includes MONGO_URI; app uses Mongo stores when MONGO_URI is set |

### Epic: Mongoose Models

| ID    | Story                                                                                    | Points | Acceptance Criteria                                                       |
| ----- | ---------------------------------------------------------------------------------------- | ------ | ------------------------------------------------------------------------- |
| S-081 | As a developer, I want a User Mongoose schema so that user data is stored in MongoDB    | 2      | User schema with firstName, lastName, email, password; model exported     |
| S-082 | As a developer, I want a Playlist Mongoose schema so that playlists are stored in Mongo | 2      | Playlist schema with title, userid (ref User); model exported             |
| S-083 | As a developer, I want a Track Mongoose schema so that tracks are stored in MongoDB     | 2      | Track schema with title, artist, duration, playlistid (ref Playlist); model exported |

### Epic: Mongo Store Implementation

| ID    | Story                                                                                        | Points | Acceptance Criteria                                                       |
| ----- | -------------------------------------------------------------------------------------------- | ------ | ------------------------------------------------------------------------- |
| S-084 | As a developer, I want a user Mongo store so that it implements the existing UserStore API  | 3      | user-mongo-store.js: addUser, getAllUsers, getUserById, getUserByEmail, deleteUserById, deleteAll |
| S-085 | As a developer, I want a playlist Mongo store so that it implements the PlaylistStore API   | 3      | playlist-mongo-store.js: addPlaylist, getPlaylistById, getUserPlaylists, deletePlaylistById, deleteAll; getPlaylistById includes tracks |
| S-086 | As a developer, I want a track Mongo store so that it implements the TrackStore API         | 3      | track-mongo-store.js: addTrack, getTrackById, getTracksByPlaylistId, deleteTrackById, deleteAllTracks |

### Epic: Store Selection

| ID    | Story                                                                                          | Points | Acceptance Criteria                                                       |
| ----- | ---------------------------------------------------------------------------------------------- | ------ | ------------------------------------------------------------------------- |
| S-087 | As a developer, I want db.init() to use Mongo stores when MONGO_URI is set so that I can switch backends | 2      | When MONGO_URI present, userStore/playlistStore/trackStore use Mongo; otherwise JSON (or mem for unit tests) |

### Epic: Unit Tests â€“ Mongo Stores (Testing)

| ID   | Story                                                                                                | Points | Acceptance Criteria                                                                 |
| ---- | ---------------------------------------------------------------------------------------------------- | ------ | ----------------------------------------------------------------------------------- |
| T-015 | As a developer, I want Mongo store unit tests so that User/Playlist/Track CRUD and contracts are verified | 3      | test/user-mongo-store-test.js, playlist-mongo-store-test.js, track-mongo-store-test.js (or single mongo-stores-test.js) against Mongo; or existing store tests run against Mongo when MONGO_URI set in test env |

### Epic: E2E MongoDB (Testing)

| ID   | Story                                                                                                    | Points | Acceptance Criteria                                                                 |
| ---- | -------------------------------------------------------------------------------------------------------- | ------ | ----------------------------------------------------------------------------------- |
| T-016 | As a developer, I want E2E tests that run against MongoDB so that the full stack with Mongo is verified | 3      | test/e2e/mongodb.spec.js: register, login, create playlist/track, verify data; restart server, login, confirm data (Mongo backend); or extend persistence.spec to run with Mongo when configured |

---

## New Deliverables

```
+ src/models/mongo/
    + connection.js (or connection in store-utils)
    + user-model.js (Mongoose schema)
    + playlist-model.js
    + track-model.js
    + user-mongo-store.js
    + playlist-mongo-store.js
    + track-mongo-store.js

Modified:
~ .env_example (MONGO_URI)
~ package.json (mongoose)
~ src/models/db.js (conditional Mongo store init when MONGO_URI set)
+ test/e2e/mongodb.spec.js (or persistence run with Mongo)
+ test/*-mongo-store-test.js (or equivalent unit tests for Mongo stores)
```

---

## Total: ~30 Story Points
